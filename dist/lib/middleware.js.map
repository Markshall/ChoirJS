{"version":3,"sources":["../../lib/middleware.js"],"names":["Middleware","middlewares","middleware","Array","isArray","concat","push","req","res","next","self","composition","reduceRight","fn","rq","rs","request","response","route","routeCheck","execute","runRoute","method","post","emit","get","put","options","writeHead"],"mappings":";;;;;;;;;;;;;IAAqBA,U;;;AACnB,wBAAc;AAAA;;AACZ,SAAKC,WAAL,GAAmB,EAAnB,CADY,CAEZ;AACD;;;;wBAEGC,U,EAAY;AACd,UAAIC,KAAK,CAACC,OAAN,CAAcF,UAAd,CAAJ,EAA+B;AAC7B,aAAKD,WAAL,GAAmB,KAAKA,WAAL,CAAiBI,MAAjB,CAAwBH,UAAxB,CAAnB;AACD,OAFD,MAEO;AACL,aAAKD,WAAL,CAAiBK,IAAjB,CAAsBJ,UAAtB;AACD;AACF;AAED;;;;;;4BAGQD,W,EAAaM,G,EAAKC,G,EAAKC,I,EAAM;AACnC,UAAMC,IAAI,GAAG,IAAb;AACA,UAAMC,WAAW,GAAGV,WAAW,CAACW,WAAZ,CAAwB,UAACH,IAAD,EAAOI,EAAP;AAAA,eAAc,UAACC,EAAD,EAAKC,EAAL,EAAY;AACpE;AACA,cAAMC,OAAO,GAAGT,GAAhB;AACA,cAAMU,QAAQ,GAAGT,GAAjB;AACAK,UAAAA,EAAE,CAACG,OAAD,EAAUC,QAAV,EAAoBR,IAApB,CAAF;AACD,SAL2C;AAAA,OAAxB,EAKjBA,IALiB,CAApB;AAMAE,MAAAA,WAAW,CAACJ,GAAD,EAAMC,GAAN,CAAX;AACD;;;wBAEGQ,O,EAASC,Q,EAAUC,K,EAAOC,U,EAAY;AAAA;;AACxC,UAAIlB,WAAW,GAAG,KAAKA,WAAvB;AAEA;;;;AAGA,UAAIE,KAAK,CAACC,OAAN,CAAce,UAAU,CAACjB,UAAzB,CAAJ,EAA0C;AACxCD,QAAAA,WAAW,GAAGA,WAAW,CAACI,MAAZ,CAAmBc,UAAU,CAACjB,UAA9B,CAAd;AACD,OAFD,MAEO;AACLD,QAAAA,WAAW,CAACK,IAAZ,CAAiBa,UAAU,CAACjB,UAA5B;AACD;;AAED,aAAO,KAAKkB,OAAL,CAAanB,WAAb,EAA0Be,OAA1B,EAAmCC,QAAnC,EAA6C,UAACV,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACtE,QAAA,KAAI,CAACY,QAAL,CAAcH,KAAd,EAAqBC,UAArB,EAAiCH,OAAjC,EAA0CC,QAA1C;AACD,OAFM,CAAP;AAGD;;;6BAEQC,K,EAAOC,U,EAAYZ,G,EAAKC,G,EAAK;AACpC,UAAME,IAAI,GAAG,IAAb;;AACA,cAAQH,GAAG,CAACe,MAAZ;AACE,aAAK,MAAL;AACEJ,UAAAA,KAAK,CAACK,IAAN,CAAWC,IAAX,CAAgBL,UAAU,CAACD,KAA3B,EAAkCX,GAAlC,EAAuCC,GAAvC;AACA;;AAEF,aAAK,KAAL;AACEU,UAAAA,KAAK,CAACO,GAAN,CAAUD,IAAV,CAAeL,UAAU,CAACD,KAA1B,EAAiCX,GAAjC,EAAsCC,GAAtC;AACA;;AAEF,aAAK,KAAL;AACEU,UAAAA,KAAK,CAACQ,GAAN,CAAUF,IAAV,CAAeL,UAAU,CAACD,KAA1B,EAAiCX,GAAjC,EAAsCC,GAAtC;AACA;;AAEF,aAAK,QAAL;AACEU,UAAAA,KAAK,UAAL,CAAaM,IAAb,CAAkBL,UAAU,CAACD,KAA7B,EAAoCX,GAApC,EAAyCC,GAAzC;AACA;;AAEF,aAAK,SAAL;AACEU,UAAAA,KAAK,CAACS,OAAN,CAAcH,IAAd,CAAmBL,UAAU,CAACD,KAA9B,EAAqCX,GAArC,EAA0CC,GAA1C;AACA;;AAEF;AACEA,UAAAA,GAAG,CAACoB,SAAJ,CAAc,GAAd;AACA;AAvBJ;AAyBD","sourcesContent":["export default class Middleware {\n  constructor() {\n    this.middlewares = [];\n    // this.event.on('end', () => console.log('End middleware called.'));\n  }\n\n  use(middleware) {\n    if (Array.isArray(middleware)) {\n      this.middlewares = this.middlewares.concat(middleware);\n    } else {\n      this.middlewares.push(middleware);\n    }\n  }\n\n  /*\n   * Don't fully know how this works, but hey, it works!\n   */\n  execute(middlewares, req, res, next) {\n    const self = this;\n    const composition = middlewares.reduceRight((next, fn) => (rq, rs) => {\n      // collect next data\n      const request = req;\n      const response = res;\n      fn(request, response, next);\n    }, next);\n    composition(req, res);\n  }\n\n  run(request, response, route, routeCheck) {\n    let middlewares = this.middlewares;\n\n    /*\n     * Merge middlewares with route.\n     */\n    if (Array.isArray(routeCheck.middleware)) {\n      middlewares = middlewares.concat(routeCheck.middleware);\n    } else {\n      middlewares.push(routeCheck.middleware);\n    }\n\n    return this.execute(middlewares, request, response, (req, res, next) => {\n      this.runRoute(route, routeCheck, request, response);\n    });\n  }\n\n  runRoute(route, routeCheck, req, res) {\n    const self = this;\n    switch (req.method) {\n      case 'POST':\n        route.post.emit(routeCheck.route, req, res);\n        break;\n\n      case 'GET':\n        route.get.emit(routeCheck.route, req, res);\n        break;\n\n      case 'PUT':\n        route.put.emit(routeCheck.route, req, res);\n        break;\n\n      case 'DELETE':\n        route.delete.emit(routeCheck.route, req, res);\n        break;\n\n      case 'OPTIONS':\n        route.options.emit(routeCheck.route, req, res);\n        break;\n\n      default:\n        res.writeHead(404);\n        break;\n    }\n  }\n}\n"],"file":"middleware.js"}